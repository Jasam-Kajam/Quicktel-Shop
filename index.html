<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quicktel Bundles - Paystack</title>
</head>
<body style="font-family:sans-serif;">
  <h1>Quicktel Bundles</h1>
  <label>Select your bundle:</label><br/>
  <select id="bundleSelect">
    <option value="daily">Daily Bundle - KSh 20</option>
    <option value="weekly">Weekly Bundle - KSh 100</option>
    <option value="monthly">Monthly Bundle - KSh 300</option>
  </select>
  <br/><br/>
  <input type="email" id="email" placeholder="Enter your email" required/>
  <br/><br/>
  <button onclick="payWithPaystack()">Pay Now</button>

  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script>
    function payWithPaystack() {
      const email = document.getElementById('email').value;
      const bundle = document.getElementById('bundleSelect').value;
      let amount = 0;

      if (bundle === 'daily') amount = 20 * 100;
      if (bundle === 'weekly') amount = 100 * 100;
      if (bundle === 'monthly') amount = 300 * 100;

      let handler = PaystackPop.setup({
        key: 'pk_live_3b95d82d975d8cd88f2e0059b1d6dca62c1db036', // Your Paystack Public Key
        email: email,
        amount: amount,
        currency: 'KES',
        callback: function(response){
          // Send reference to backend for verification
          fetch('http://localhost:5000/verify-payment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ reference: response.reference, bundle: bundle, email: email })
          })
          .then(res => res.json())
          .then(data => alert(data.message))
          .catch(err => alert('Verification failed'));
        },
        onClose: function(){
          alert('Payment cancelled');
        }
      });
      handler.openIframe();
    }
  </script>
</body>
</html>