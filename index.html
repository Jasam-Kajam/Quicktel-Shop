<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quicktel Bundles</title>
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f1f3f6;
            margin: 0;
            padding: 0;
        }
        .header {
            background: #fff;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 20px;
            border-bottom: 1px solid #ddd;
        }
        .bundle-card {
            background: #fff;
            margin: 15px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }
        .bundle-title {
            font-size: 24px;
            font-weight: bold;
            color: #111;
        }
        .bundle-desc {
            color: #666;
            margin: 5px 0;
        }
        .tag {
            background: #f1f3f6;
            display: inline-block;
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 15px;
            margin-bottom: 10px;
            color: #333;
        }
        .select-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px;
            width: 100%;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fff;
            margin: 15% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 400px;
        }
        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="header">QUICKTEL BUNDLES</div>

<div class="bundle-card">
    <div class="tag">Popular now</div>
    <div class="bundle-title">KSh 50</div>
    <div class="bundle-desc">175 MB · No expiry & WhatsApp</div>
    <button class="select-btn" onclick="openModal(50, '175MB - No Expiry')">Select</button>
</div>

<div class="bundle-card">
    <div class="tag">Good deal</div>
    <div class="bundle-title">KSh 20</div>
    <div class="bundle-desc">1GB · 1 Hour</div>
    <button class="select-btn" onclick="openModal(20, '1GB - 1 Hour')">Select</button>
</div>

<!-- (add more bundles similarly here) -->

<!-- Modal -->
<div id="paymentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3>Enter Phone Number</h3>
        <input type="text" id="phoneNumber" placeholder="e.g 0712345678" style="width: 100%; padding: 10px; margin-bottom: 15px; font-size: 16px;">
        <button class="select-btn" onclick="startPay()">Proceed to Pay</button>
    </div>
</div>

<script>
    let selectedAmount = 0;
    let selectedBundle = '';

    function openModal(amount, bundle) {
        selectedAmount = amount;
        selectedBundle = bundle;
        document.getElementById('paymentModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('paymentModal').style.display = 'none';
    }

    function startPay() {
        const phone = document.getElementById('phoneNumber').value.trim();
        if (!phone.match(/^07\d{8}$/)) {
            alert('Please enter a valid Safaricom number.');
            return;
        }
        closeModal();

        let handler = PaystackPop.setup({
            key: 'pk_live_3b95d82d975d8cd88f2e0059b1d6dca62c1db036',  // Replace with your Paystack Public Key
            email: 'quicktel@customer.com',
            amount: selectedAmount * 100, // in kobo
            currency: "KES",
            callback: function(response) {
                verifyPayment(response.reference, phone);
            },
            onClose: function() {
                alert('Transaction closed.');
            }
        });
        handler.openIframe();
    }

    async function verifyPayment(reference, phone) {
        const response = await fetch('http://localhost:5000/verify-payment', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                reference: reference,
                bundle: selectedBundle,
                phone: phone
            })
        });

        const data = await response.json();
        if (response.ok) {
            alert(data.message);
        } else {
            alert('Payment failed: ' + data.message);
        }
    }
</script>

</body>
</html>